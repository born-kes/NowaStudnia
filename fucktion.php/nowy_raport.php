<?php /* zapytanie o wioskev	pokaø raport => jaki => GET[typ]nowy raport => co pobraÊ by porÛwnaÊ*//*  WARZNE Function * Data($GET['data']); * Data2Nowsza($data1 < $data2) * zap_Nowy_wpis($from, $Array_values, $nowy=true){ * * function_exists($test); -- function sprawdza czy funcia istnieje *//*	Tablica zwracana przez raport($typ,$id)0:id_wsi:			ws_all1:wlasnosc:			ws_all2:id:			ws_raport3:data_raport:	ws_raport4:pik:			ws_raport5:mie:			ws_raport6:axe:			ws_raport7:luk:			ws_raport8:zw:			ws_raport9:lk:			ws_raport10:kl:			ws_raport11:ck:			ws_raport12:tar:			ws_raport13:kat:			ws_raport14:ry:			ws_raport15:sz:			ws_raport16:player:		ws_raport		=> id USERA17:data_mobile:		ws_mobile18:procent:			ws_mobile	=> function procent ilosci wojsk (co zosta≥o) / (max ~22000) = % zagrody19:donos:			ws_mobile	=> id USERA20:typ_data:	ws_typ21:typ:			ws_typ			=> OFF	policzony u urzytkownika 22:mur_data:		ws_mur23:mur:				ws_mur		=> policzony u uøytkownika24:opis_data:	ws_opis25:opis:		ws_opis			=> efekt ataku26:status_data:		ws_status27:status:			ws_status	=> OBRONA policzony u uøytkownika 28:zwiad_data:	ws_zwiad		=> godzina powrotu 	29:ile: 		ws_zwiad		porownanie daty mobilne // raport nowszyKoniec */if(isset($GET['w']) )@list($W['pik'],$W['mie'],$W['axe'],$W['luk'],$W['zw'],$W['lk'],$W['kl'],$W['ck'],$W['tar'],$W['kat'],$W['ry'],$W['sz'])= explode(",",$GET['w']); # -- Kluczowa kontrola --  #  ID wioski jest niezbendne if(isset($GET['id']) ){	# -- Pobranie Raportu z BD jesli jeszcze niema!isset($raport)?	$raport = raport((int)$GET['id'] , $GET['typ']):''; /* Dla testÛw skryptu  *!isset($GET['data'])? $GET['data']=date('Y-m-d H:i:s',time()-60) :'';  */  	# -- Sprawdzenie Czy Data przys≥ana nie jest nowsza od Teraz -- # if(isset($GET['data']) && Data2Nowsza($GET['data'],Data() ) ){ /* PorÛwnanie èrude≥  * - Sprawdza czy Stary raport nie jest Lepszy  *		- Data nowo nades≥anego  *		- Data Zapisanego BD  *  *		- ZW - jeúli zwiad w drodze do dodaÊ  *			- Function Sprawdz zwiad w drodze dla wioski ( ID )  *		- Wojsko Mobilne   *			- Function Sprawdza Wojsko w drodze dla wioski ( ID )  *  *		- Typ wioski jesli sie zmieni øπdaj potwierdzenia ?  */ 	# -- Sprawdzanie Zapisanych wojska mobilne -- #	if( Data2Nowsza($raport['data_mobile'],$GET['data']) ){					// -- stare mobile niema znaczenia -- unset($efekt);									//ustalenie typu wioski												// typ wioski ustalony w przeglπdarce		if(isset($GET['typ_mobile']))		$efekt['typ_mobile']	= (int)$GET['typ_mobile'];		if(isset($W) )		$efekt['procent']		= (int)(ilosc_zagroda($W)/22000);		 isset($efekt)?// zmieniÊ dane		zap_Nowy_wpis('mobile' , $efekt ):'';		};	// END IF data_Mobile + typ_mobile	# -- Sprawdzanie Zapisany Stan Muru -- #if( isset($GET['mur']) ){	include(F_CIA .'/nowy_mur'.PHP);}	# -- Sprawdzanie Zapisane Wojska w Wiosce --#  	if( Data2Nowsza($raport['data_raport'],$GET['data']) ){					// sary raport wys≥any do opisÛwunset($efekt);		// Raport z wioski		if(isset($GET['w']) && is_array($w) ){		$efekt=$W;		$efekt['donos'] = $GET['user_id'];		}isset($efekt)?// zmieniÊ dane		zap_Nowy_wpis('raport' ,  $efekt ):'';    };	// END IF data_raport 	# -- Ocena i Sprawdzenie Typu Wioski --#  	if( Data2Nowsza($raport['data_typ'],$GET['data']) ){					/*/ Typ wioski siÍ chyba nie zmienia jak sie zmieni to opisunset($efekt);			// typ ustalony w przeglπdarce		if( isset($GET['typ']) )		$efekt['typ']	= $GET['typ'];		isset($efekt)?// zmieniÊ dane		zap_Nowy_wpis($from, $value, $nowy=true):'';  */    };	// END IF data_typ	# -- Sprawdzanie i Zapisanie Ilosci teoretycznej iloúci Zwiadu -- #		if(isset($GET['zw']) && Data2Nowsza($raport['data_zwiad'],$GET['data']) ){					// sprawdziÊ ruchy wojsk czy dodaÊ czy nie dodawaÊunset($efekt);		if($GET['zw'])		$efekt['zw'] = $GET['zw'];		isset($efekt)?// zmieniÊ dane	zap_Nowy_wpis('zwiad' ,$efekt):'';	    };	// END IF data_zwiad						 }	// END IF data 	# -- Metoda podania Efektu -- if(isset($raport) && isset($GET['dane']) && $GET['dane']=='json' ){   headJSON();  body_js('var json='. json($raport) );  }else if( isset($raport) ){ body('raport'); }}